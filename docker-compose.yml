include:
  - path: docker-compose.services.yml
    env_file:
      - env/shared.env
      - env/shared.local.env
      - env/backend.env
      - env/backend.local.env

# Define the extra_hosts as a reusable anchor
x-host-access: &host-access
  extra_hosts:
    # This allows containers to access services running on a host linux machine
    # Unnecessary but harmless for mac/windows users
    - "host.docker.internal:host-gateway"

services:
  web:
    extends:
      file: docker-compose.apps.yml
      service: web
    <<: *host-access
    env_file:
      - path: env/shared.env
      - path: env/shared.local.env
        required: false
      - path: env/backend.env
      - path: env/backend.local.env
        required: false
      # DEPRECATED: legacy .env file at the repo root
      - path: .env
        required: false

  watch:
    extends:
      file: docker-compose.apps.yml
      service: watch
    <<: *host-access
    env_file:
      - path: env/shared.env
      - path: env/shared.local.env
        required: false
      - path: env/frontend.env
      - path: env/frontend.local.env
        required: false
      # DEPRECATED: legacy .env file at the repo root
      - path: .env
        required: false

  celery:
    extends:
      file: docker-compose.apps.yml
      service: celery
    <<: *host-access
    env_file:
      - path: env/shared.env
      - path: env/shared.local.env
        required: false
      - path: env/backend.env
      - path: env/backend.local.env
        required: false
      # DEPRECATED: legacy .env file at the repo root
      - path: .env
        required: false
